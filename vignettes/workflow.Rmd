---
title: "Workflow"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Workflow}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
library(ggxpose)

xpdb <- xpdb_ex_pk

knitr::opts_chunk$set(fig.dpi = 96,
                      fig.align = 'center', 
                      fig.height = 4, 
                      fig.width = 4,
                      out.width = '50%')
```


### Load ggxpose
The first step is to load ggxpose in R with the following command.
```r
library(ggxpose)
```

### Import model output
The function `xpose_data()` collects all model output files and table and organizes them into an R object commonly called `xpdb` which stands for xpose data base.

``` r
xpdb <- xpose_data(runno = '001', dir = 'analysis/model/pk/')
```

### Generating plots
Many functions will be made available in the next release of ggxpose. Currently available functions are:

 - DV vs. PRED (`dv_vs_pred()`)   
 - DV vs. IPRED (`dv_vs_ipred()`)   
 - CWRES vs. IDV (`cwres_vs_idv()`)   
 - CWRES vs. PRED (`cwres_vs_pred()`)   
 - |IWRES| vs. PRED (`absval_iwres_vs_pred()`)   
 
These functions are used as follow:
``` {r demo basic gof}
# DV vs. IPRED plot
dv_vs_ipred(xpdb)

# CWRES vs. PRED plot
cwres_vs_pred(xpdb)
```


### Exporting plots
The `xpose_save` function was designed to facilitated the export of plots from R to files. ggxpose will automatically save plots according to their run number and the plotting function using keywords preceded by a `@` you can learn more about these keywords using `help('template_titles')`. The file extension is guessed from the file name and must match one of .pdf, .jpeg, .png, .bmp or .tiff, if missing a pdf will be generated by default. Finally, if the `plot` argument is left empty `xpose_save` will automatically save the last plot that was generated by ggplot2.

```{r, eval = FALSE}
# Save the last plot
xpose_save()

# Change file name and extension
xpose_save(filename = '@run_@plotfun_[@ofv].jpeg')
```


### The pipes
`ggxpose` makes use of the pipe operator `%>%` from the package [dplyr](http://dplyr.tidyverse.org). Pipes can be used to generate clear workflow.

```{r, eval = FALSE}
xpose_data(runno = '001') %>% 
  dv_vs_ipred() %>% 
  xpose_save()
```
